---
lab:
    title: '랩 02: Azure IoT Services 시작'
    module: '모듈 1: IoT 및 Azure IoT 서비스 소개'
---

# Azure IoT Services 시작하기

## 랩 시나리오

치즈를 생산하고 유통하는 Contoso에서 Azure IoT 개발자로 근무하고 있습니다.

Contoso의 IoT 솔루션을 개발하는 데 사용할 Azure 및 Azure IoT 서비스를 파악하라는 요청을 받았습니다. Azure Portal 사용법은 이미 파악했으며, 프로젝트용 리소스 그룹을 만들었습니다. 이제 Azure IoT 서비스 조사를 시작해야 합니다.

## 랩 내용

이 랩에서는 Azure IoT Hub 및 IoT Hub Device Provisioning Service를 만들고 살펴봅니다. 랩에 포함된 연습은 다음과 같습니다.

* 전역 고유 리소스 명명 요구 사항 살펴보기
* Azure Portal을 사용하여 IoT Hub 만들기
* IoT Hub 서비스 기능 검토
* 디바이스 프로비저닝 서비스를 만들고 IoT Hub에 연결
* 디바이스 프로비저닝 서비스 기능 검사

## 랩 지침

### 연습 1: 전역 고유 리소스 명명 요구 사항 살펴보기

이 과정의 랩 2-20에서는 IoT 솔루션을 개발하는 데 사용할 Azure 리소스를 만듭니다. 랩 전체의 일관성을 보장하고 랩 완료 시 리소스를 정리할 수 있도록, 랩 지침 내에서 제안 리소스 이름이 제공됩니다. 제안 리소스 이름은 [권장 명명 및 태그 지정 규칙](https://docs.microsoft.com/ko-kr/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging)에서 권장하는 명명 지침을 최대한 준수합니다. 그러나 이 과정에서 만드는 대다수 리소스는 웹 전반에 걸쳐 사용할 수 있는 서비스를 표시하므로, 전역적으로 고유한 이름을 지정해야 합니다. 이러한 리소스가 전역 고유 요구 사항을 충족할 수 있도록 필요 시 리소스 이름 끝에 고유 식별자를 추가합니다.

이 연습에서는 고유 ID를 만들고, 이 과정의 랩 2-20에서 고유 ID를 사용하는 방법을 파악할 수 있는 몇 가지 예제를 검토합니다.

#### 작업 1: 고유 ID 만들기

1. 사용자의 소문자 이니셜과 현재 날짜를 다음과 같은 패턴으로 사용하여 고유 ID를 생성합니다.

    ```text
    YourInitialsYYMMDD
    ```

    고유 ID의 첫부분이 사용자의 소문자 이니셜입니다. 그리고 두 번째 부분은 현재 연도의 끝 2자리, 현재 월(숫자) 및 오늘 날짜(숫자)입니다. 고유 ID의 몇 가지 예는 다음과 같습니다.

    ```text
    gwb200123
    bho200504
    cah201216
    dm200911
    ```

    랩 지침 내에서는 고유 ID를 입력해야 할 때마다 제안 리소스 이름의 일부분으로 `{your-id}`가 표시됩니다. 제안 리소스 이름의 `{your-id}` 부분은 자리 표시자입니다. 전체 자리 표시자 문자열(`{}` 포함)을 고유한 값으로 바꿉니다.

1. 지금 고유한 ID를 적어 두고 **전체 과정에서 동일한 값을 사용**하세요.

    > **참고**: 고유 ID의 날짜 부분을 매일 변경해서는 안 되며 전체 과정 기간 동안 매일 같은 고유 ID를 사용해야 합니다.

#### 작업 2: 고유 ID를 적용하는 방법과 상황 검토

이 과정의 랩을 진행하면서 만드는 대부분의 리소스에는 공개적으로 주소를 지정할 수 있는 엔드포인트(보안 엔드포인트)가 포함됩니다. 따라서 리소스 이름을 전역적으로 고유하게 지정해야 합니다. 전역적으로 고유한 이름을 지정해야 하는 리소스의 예로는 IoT Hubs, Device Provisioning Services, Azure Storage 계정 등이 있습니다.

앞에서 설명한 것처럼, 이러한 종류의 리소스를 만들 때는 제안 지침을 준수하는 리소스 이름, 그리고 리소스 이름의 일부분으로 고유 ID를 포함하라는 지침이 제공됩니다. 그리고 고유 ID를 입력해야 하는 경우를 명확하게 파악할 수 있도록 제안되는 리소스 이름에는 고유 ID에 해당하는 자리 표시자 값이 포함됩니다. 이러한 경우에는 자리 표시자 값인 `{your-id}`를 고유 ID로 바꾸라는 지침이 제공됩니다.

1. 다음의 리소스 명명 예제를 검토해 보세요.

    고유 ID가 **cah191216**인 경우

    | 리소스 유형 | 이름 템플릿 | 예제 |
    | :--- | :--- | :--- |
    | IoT Hub | iot-az220-training-{your-id} | iot-az220-training-cah191216 |
    | Device Provisioning Service | dps-az220-training-{your-id} | dps-az220-training-cah191216 |
    | Azure 스토리지 계정<br/>(이름은 소문자여야 하고 하이픈은 사용할 수 없습니다) | az220storage{your-id} | az220storagecah191216 |

1. Bash 스크립트 내에서 고유 ID를 적용하는 다음 예제를 검토해 보세요.

    이 과정 뒷부분에서 진행할 일부 랩에서는 Bash 스크립트 내에서 고유 ID 값을 적용하라는 지침이 제공됩니다. 랩에서 제공되는 Bash 스크립트 파일에는 다음과 같은 코드가 포함되어 있을 수 있습니다.

    ```bash
    #!/bin/bash

    YourID="{your-id}"
    RGName="rg-az220"
    IoTHubName="iot-az220-training-$YourID"
    ```

    위의 코드에서 고유 ID 값이 `cah191216`이라면 `YourID="{your-id}"`가 포함된 줄을 `YourID="cah191216"`으로 업데이트해야 합니다.

    > **참고**: 마지막 코드 줄의 `$YourID` 값은 변경하지 않습니다. 이 값이 `{your-id}`가 아니면 바꾸지 마세요.

1. C# 코드 내에서 고유 ID를 적용하는 다음 예제를 검토해 보세요.

    이 과정 뒷부분에서 진행할 일부 랩에서는 C# 소스 파일 내에서 고유 ID 값을 적용하라는 지침이 제공됩니다. 랩에서 제공되는 C# 소스 코드에는 다음과 같은 코드 섹션이 포함되어 있을 수 있습니다.

    ```csharp
    private string _yourId = "{your-id}";
    private string _rgName = "rg-az220";
    private string _iotHubName = $"iot-az220-training-{_yourId}";
    ```

    위의 코드에서 고유 ID 값이 `cah191216`이라면 `private string _yourId = "{your-id}";`가 포함된 줄을 `private string _yourId = "cah191216";`으로 업데이트해야 합니다.

    > **참고**: 마지막 코드 줄의 `_yourId` 값은 변경하지 않습니다. Bash에서와 마찬가지로 이 값이 `{your-id}`가 아니면 바꾸지 마세요.

1. 모든 리소스 이름에 고유 ID를 적용해야 하는 것은 아닙니다.

    이미 확인했던 것처럼 이전 랩에서 만든 리소스 그룹에는 고유 ID 값이 포함되지 않습니다.

    리소스 그룹 등의 일부 리소스에는 구독 내에서 고유한 이름을 사용해야 합니다. 그러나 해당 이름이 전역적으로 고유할 필요는 없습니다. 따라서 이 과정을 진행하는 각 수강생은 리소스 그룹 이름 **rg-az220**을 사용할 수 있습니다. 물론 이 이름은 각 수강생이 자체 구독을 사용하는 경우에만 사용 가능하지만, 원칙적으로는 모든 수강생이 같은 리소스 그룹 이름을 사용해도 됩니다.

1. 고유 ID가 고유하지 않은 것으로 확인되면 `01`, `02` 등을 추가합니다.

    이니셜이 같은 수강생 여러 명이 같은 날짜에 과정을 시작하는 경우를 예로 들 수 있습니다. 하지만 다음 연습에서 IoT Hub를 만들 때까지는 이니셜이 같은 사람이 있음을 모를 수도 있습니다. 고유 ID를 포함한 제안 리소스 이름이 전역적으로 고유하지 않으면 Azure에서 해당 알림이 표시됩니다. 이 경우에는 `##` 값을 더 추가하여 고유 ID를 업데이트하라는 지침이 표시됩니다. 예를 들어 고유 ID 값이 `cah191216`이라면 업데이트된 고유 ID 값은 다음과 같을 수 있습니다.

    ```text
    cah20121600
    cah20121601
    cah20121602
    ...
    cah20121699
    ```

    고유 ID를 업데이트할 필요가 없으면 과정 전체에서 동일하게 사용하세요.

### 연습 2: Azure Portal을 사용하여 IoT Hub 만들기

Azure IoT Hub는 IoT 디바이스와 Azure 간의 안정적이고 안전한 양방향 통신을 가능하게 하는, 완전 관리형 서비스입니다. Azure IoT Hub 서비스는 다음을 제공합니다.

* 수십억 개의 IoT 디바이스로 양방향 통신 구축
* 단방향 메시지, 파일 전송 및 요청-회신 방법을 비롯한 여러 가지 디바이스-클라우드 및 클라우드-디바이스 통신 옵션.
* 기본 제공 선언적 메시지를 다른 Azure 서비스로 라우팅.
* 디바이스 메타데이터 및 동기화된 상태 정보에 대한 쿼리 가능한 저장소.
* 디바이스 단위 보안 키 또는 X.509 인증서를 사용하는 보안 통신 및 액세스 제어
* 디바이스 연결 및 디바이스 ID 관리 이벤트에 대한 광범위한 모니터링.
* 가장 많이 사용되는 언어와 플랫폼에 대한 SDK 디바이스 라이브러리.

IoT Hub를 만드는 데 사용할 수 있는 몇 가지 방법이 있습니다. 예를 들어 Azure Portal을 사용하여 IoT Hub 리소스를 만들 수도 있고 프로그래밍 방식으로 IoT Hub(및 기타 리소스)를 만들 수도 있습니다. 이 과정에서는 Azure CLI, Bash 스크립트 등 Azure 리소스를 만들고 관리하는 데 사용할 수 있는 여러 가지 방법을 조사합니다.

이 연습에서는 Azure Portal을 사용하여 IoT Hub를 만들고 구성합니다.

#### 작업 1: Azure Portal을 사용하여 리소스 만들기 (IoT Hub)

1. Azure 계정 자격 증명을 사용하여 [portal.azure.com](https://portal.azure.com)에 로그인합니다.

    Azure 계정이 두 개 이상인 경우 이 과정에 사용할 구독에 연결된 계정으로 로그인해야 합니다.  실수로 잘못된 계정을 사용하지 않도록 InPrivate / 시크릿 브라우저 세션을 사용하는 것이 가장 쉽습니다.

1. 이전 랩에서 만든 AZ-220 대시보드가 로드되었습니다.

    과정이 계속됨에 따라 대시보드에 리소스를 추가합니다.

1. Azure Portal 메뉴에서 **+ 리소스 만들기**를 클릭합니다.

    그러면 열리는 **새로 만들기** 블레이드는 Azure Marketplace의 프런트 엔드입니다. Azure Marketplace에서는 Azure에서 만들 수 있는 모든 리소스의 컬렉션이 제공됩니다. 마켓플레이스에는 Microsoft와 커뮤니티의 리소스가 포함되어 있습니다.

1. 검색 텍스트 상자에 **IoT Hub**를 입력하고 **Enter 키**를 누릅니다.

    **Marketplace** 블레이드가 열리고 검색 기준과 일치하는 사용 가능한 서비스가 표시됩니다.

    > **참고**: 개인 기여자가 제공하는 Marketplace 서비스에는 Microsoft Azure Pass 또는 기타 Microsoft Azure 제공 무료 크레딧이 적용되지 않는 비용이 포함될 수 있습니다. 이 과정의 랩에서는 Microsoft에서 제공하는 리소스를 사용합니다.

1. **Marketplace** 블레이드에서 **IoT Hub** 검색 결과를 클릭합니다.

    > **참고**:
    > **IoT Hub** 검색 결과 아래쪽에 표시되는 **만들기** 작업을 클릭하면 IoT Hub 만들기 보기로 바로 이동할 수 있습니다. 일반적인 사용 상황에서는 이 작업을 클릭할 수 있습니다. 하지만 이 자습서에서는 **IoT Hub** 검색 결과 본문의 아무 위치나 클릭합니다.

1. **IoT Hub** 블레이드에서 **사용량 정보 + 지원**을 클릭합니다.

    **유용한 링크** 아래에서 리소스 링크 목록을 살펴봅니다.

    지금 이러한 링크를 탐색할 필요는 없지만 해당 리소스를 사용할 수 있다는 점은 알고 있는 것이 좋습니다. 예를 들어 _설명서_ 링크를 클릭하면 IoT Hub 리소스 및 설명서의 루트 페이지로 이동할 수 있습니다. 이 페이지를 사용하면 최신 Azure IoT Hub 설명서를 검토할 수 있으며 이 과정에서 다루지 않는 추가 리소스도 살펴볼 수 있습니다. 이 과정 전반에 걸쳐 특정 주제에 대한 추가적인 읽을거리를 제공하기 위해 docs.microsoft.com 사이트를 참조해 드립니다.

    링크 중 하나를 열었다면 지금 닫고 브라우저에서 Azure Portal 탭으로 다시 이동합니다.

#### 작업 2: 필수 속성이 설정된 IoT Hub 만들기

1. 새 IoT Hub를 만드는 프로세스를 시작하려면 **만들기**를 클릭합니다.

    > **팁:** 향후 Azure 리소스 유형 _만들기_ 환경을 얻는 두 가지 방법이 더 있습니다.
    >
    >    1. 즐겨찾기에 서비스가 있는 경우 서비스를 클릭하여 인스턴스 목록으로 이동한 다음 상단의 _+ 추가_ 단추를 클릭합니다.
    >    2. 포털 상단의 _검색_ 상자에서 서비스 이름을 검색하여 인스턴스 목록으로 이동한 다음 상단의 _+ 추가_ 단추를 클릭합니다.

    다음 단계에서는 IoT Hub를 만드는 데 필요한 설정을 안내하고 각 필드를 채울 때 마다 설명을 덧붙입니다.

1. **IoT Hub** 블레이드의 **구독** 드롭다운에서 이 과정에서 사용할 Azure 구독이 선택되어 있는지 확인합니다.

    초기 선택되어 있는 _기본_ 탭에는 정보를 입력해야 하는 초기화되지 않은 필드가 포함되어 있습니다. 그와 동시에, 다른 탭의 설정도 숙지해야 합니다.

1. **리소스 그룹** 오른쪽에서 드롭다운을 열고 **rg-az220**을 클릭합니다.

    이전 랩에서 만든 리소스 그룹입니다. 이 과정에서 만든 리소스를 동일한 리소스 그룹들과 함께 그룹화합니다. 모범 사례에 따라 이 방식으로 관련 리소스를 그룹화하면 더 이상 필요하지 않은 리소스를 정리할 수 있습니다.

1. **지역** 오른쪽의 드롭다운 목록을 열고 리소스 그룹용으로 선택한 것과 같은 지역을 선택합니다.

    > **참고**: 이후 진행할 랩 중 하나에서는 Event Grid를 사용합니다. 나중에 이 랩을 정상적으로 진행하려면 Event Grid를 지원하는 지역을 선택해야 합니다. Event Grid를 지원하는 지역의 현재 목록은 다음 링크를 참조하세요. [지역별로 사용 가능한 제품](https://azure.microsoft.com/ko-kr/global-infrastructure/services/?products=event-grid&regions=all)

    앞에서 보았듯이 Azure는 전 세계 지역에 배치된 일련의 데이터 센터에서 지원됩니다. Azure에서 무언가를 만들 때 이러한 데이터 센터 위치 중 하나에 배포합니다.

    > **참고**:  리소스를 호스팅할 지역을 선택할 때 최종 사용자에게 가까운 지역을 선택하면 로드/응답 시간이 줄어듭니다. 프로덕션 환경에서는 최종 사용자로부터 지구 반대편에 있는 경우, 가장 가까운 지역을 선택해서는 안 됩니다.

1. **IoT Hub 이름** 오른쪽에 전역에서 고유한 IoT Hub 이름을 다음과 같이 입력합니다.

    전역적으로 고유한 이름을 제공하려면 **iot-az220-training-{your-id}**를 입력합니다(**{your-id}**는 연습 1에서 만든 고유 ID로 바꿔야 함).

    예를 들어 **iot-az220-training-cah191216**과 같이 입력할 수 있습니다.

    IoT Hub의 이름은 IP 지원 IoT 모든 디바이스에서 액세스할 수 있어야 하는 공개적으로 액세스할 수 있는 리소스이므로 전역적으로 고유해야 합니다.

    새 IoT Hub에 고유한 이름을 지정할 때 다음을 고려하십시오.

    * **IoT Hub 이름**에 적용하는 값은 모든 Azure에서 고유해야 합니다. 이름에 할당된 값이 IoT Hub의 연결 문자열에 사용되기 때문에 이는 마찬가지입니다. Azure를 사용하면 전 세계 어디서나 허브에 장치를 연결할 수 있으므로 연결 문자열을 사용하여 인터넷에서 모든 Azure 허브에 액세스할 수 있어야 하며 연결 문자열은 고유해야 합니다. 이 랩의 뒷부분에서 연결 문자열을 살펴보겠습니다.

    * 리소스를 만든 후에는 **IoT Hub 이름**에 할당하는 값을 변경할 수 없습니다. 이름을 변경해야 하는 경우 원하는 이름으로 새 IoT Hub를 만들고 원래 IoT Hub에서 디바이스를 다시 등록한 다음 새 IoT Hub에 디바이스를 등록하고 이전 IoT Hub를 삭제해야 합니다.

    * **IoT Hub 이름** 필드는 필수 필드입니다.

    > **참고**:  Azure는 입력한 이름이 고유한지 확인합니다. 입력한 이름이 고유하지 않은 경우 Azure에서 이름 필드 아래에 경고 메시지가 표시됩니다. 경고 메시지가 표시되면 고유 ID를 업데이트해야 합니다. 필요에 따라 고유 ID에 '**00**', '**01**', '**02**,' 등을 추가하여 전역적으로 고유한 이름을 생성할 수 있습니다.

    > **참고**: 대시(-)나 밑줄(_) 등의 확장 문자를 사용할 수 없는 리소스 이름도 있으므로 고유 ID를 업데이트할 때는 숫자를 추가하세요.

1. 블레이드 상단에서 **관리**를 클릭합니다.

    이 탭에 표시되는 필드와 기타 정보를 잠시 검토합니다.

1. **가격 책정 및 크기 계층** 오른쪽에서 **S1: 표준 계층**이 선택되어 있는지 확인합니다.

    Azure IoT Hub에서는 필요한 기능 수와 하루에 솔루션 내에서 보내야 하는 메시지 수에 따라 여러 계층 옵션을 제공합니다. 이 과정에서 사용하는 _S1_ 계층은 하루에 단위당 총 400,000개의 메시지를 허용하며 이 교육에 필요한 모든 서비스를 제공합니다. 실제로는 매일 단위당 400,000개의 메시지가 필요하지 않지만 _클라우드-디바이스 명령_, _디바이스 관리_, _IoT Edge_ 등 표준 계층에서 제공되는 기능을 사용할 것입니다. IoT Hub는 또한 테스트와 평가를 위한 무료 계층을 제공합니다. 무료 계층 역시 표준 계층과 같은 기능을 제공하지만 허용되는 메시지 수가 제한됩니다. 무료 계층에서 기본 또는 표준 계층으로 업그레이드할 수 없습니다. 무료 계층에서는 IoT Hub에 500개 디바이스를 연결할 수 있으며 하루에 8,000개 메시지까지 허용합니다. 각 Azure 구독에서는 무료 계층에 IoT Hub 하나를 만들 수 있습니다.

    > **참고**:  _S1 - 표준_ 계층의 비용은 단위 당 월 $25.00 USD입니다. 1 단위를 지정합니다. 다른 계층 옵션에 대한 자세한 내용은 [솔루션에 적합한 IoT Hub 계층 선택](https://docs.microsoft.com/ko-kr/azure/iot-hub/iot-hub-scaling)을 참조하세요.

1. **S1 IoT Hub 단위 수** 오른쪽에서 **1**이 선택되어 있는지 확인합니다.

    위에서 언급했듯이 선택한 가격 책정 계층은 허브가 하루에 단위당 처리할 수 있는 메시지 수를 설정합니다. 더 높은 가격 책정 계층으로 이동하지 않고 허브에서 처리할 수 있는 메시지 수를 늘리려면 단위 수를 늘릴 수 있습니다. 예를 들어 IoT Hub가 매일 800,000개의 메시지 수신을 지원하도록 하려면 S1 계층 단위 *2개*를 지정할 수 있습니다. 이 과정에서는 단위 1개만 사용합니다.

1. **Defender for IoT** 오른쪽에서 **꺼짐**이 선택되어 있는지 확인합니다.

    Azure Defender for IoT는 IoT/OT 디바이스, 취약성 및 위협을 확인할 수 있는 통합 보안 솔루션입니다. 이 솔루션을 사용하면 전체 IoT/OT 환경을 보호할 수 있습니다. 가령 기존 IoT/OT 디바이스를 보호해야 하거나 새로운 IoT 혁신 기술에 보안 기능을 추가해야 하는 경우 이 솔루션을 사용할 수 있습니다.

    > **팁**:
    **Azure Defender for IoT**의 이전 명칭은 **Azure Security Center**입니다. Azure 및 이 과정 콘텐츠에서 명칭이 아직 업데이트되지 않은 부분도 있을 수 있습니다.

    IoT 솔루션에서는 보안이 중요하므로, Azure Defender for IoT는 기본적으로 켜집니다. 이 과정의 랩 19에서 Azure Defender for IoT를 살펴봅니다. 랩 19의 지침이 정상적으로 작동하도록 일단은 Azure Defender for IoT를 사용하지 않도록 설정하겠습니다.

    현재는 Azure Portal을 통해 구독 수준에서 Azure Defender를 사용하도록 설정할 수 있습니다. Azure Defender는 처음 30일 동안 무료입니다. 30일을 초과하는 모든 사용량은 [여기](https://azure.microsoft.com/ko-kr/pricing/details/azure-defender/)에 설명된 가격 책정 정보에 따라 자동으로 청구됩니다.

1. **고급 설정**을 확장하고 **디바이스-클라우드 파티션**이 **4**로 설정되어 있는지 확인합니다.

    파티션 수는 디바이스-클라우드 메시지와 이러한 메시지의 동시 판독기 수와 관련이 있습니다. 대부분의 IoT Hub에는 기본값인 4개의 파티션만 필요합니다. 이 과정에서는 기본 파티션 수를 사용하여 IoT Hub를 만듭니다.

1. **TLS(전송 계층 보안)** 섹션에서 **최소 TLS 버전**이 **1.0**으로 설정되어 있는지 확인합니다.

    IoT Hub는 TLS(전송 계층 보안)를 사용하여 IoT 디바이스 및 서비스의 연결을 보호합니다. 현재 세 가지 버전의 TLS 프로토콜(버전 1.0, 1.1 및 1.2)이 지원됩니다.

    > [!중요]
    > IoT Hub 리소스를 만든 후에는 **최소 TLS 버전** 속성을 변경할 수 없습니다. 따라서 모든  IoT 디바이스 및 서비스가 TLS 1.2 및 권장되는 암호와 호환되는지 적절히 테스트하고 유효성을 검사하는 것이 중요합니다. 다음 페이지에서 IoT Hub 및 TLS에 대해 자세히 알아볼 수 있습니다.
    > * [IoT Hub의 TLS(전송 계층 보안) 지원](https://docs.microsoft.com/azure/iot-hub/iot-hub-tls-support)

1. 블레이드 상단에서 **검토 + 만들기**를 클릭합니다.

    잠시 제공한 설정을 검토합니다.

1. 블레이드 하단에서 IoT Hub 만들기를 완료하려면 **만들기**를 클릭합니다.

    배포를 완료하는 데 1분 이상 걸릴 수 있습니다. Azure Portal 알림 창을 열어 진행을 모니터링할 수 있습니다.

1. 몇 분 후에 IoT Hub가 **rg-az220** 리소스 그룹에 성공적으로 배포되었다는 알림을 받게 됩니다.

1. Azure Portal 메뉴에서 **대시보드**, **새로 고침**을 차례로 클릭합니다.

    리소스 그룹 타일에 새 IoT Hub가 나열되어 있는지 확인합니다.

### 연습 3: IoT Hub 서비스 검토

앞에서 이미 확인했듯이, IoT Hub는 클라우드에서 호스팅되는 관리 서비스이며, Azure IoT 서비스와 연결된 디바이스 간의 양방향 통신을 위한 중앙 메시지 허브 역할을 합니다.

IoT Hub의 기능을 사용하면 제조에 사용되는 산업용 장비의 관리, 의료 분야의 귀중한 자산 추적, 사무용 건물 사용 모니터링과 같은 확장성과 모든 기능을 갖춘 IoT 솔루션을 구축할 수 있습니다. IoT Hub 모니터링을 사용하면 디바이스 생성, 디바이스 오류 및 디바이스 연결과 같은 이벤트를 추적하여 솔루션의 상태를 유지 관리할 수 있습니다.

이 연습에서는 IoT Hub에서 제공하는 몇 가지 기능을 살펴봅니다.

#### 작업 1: IoT Hub 개요 정보 살펴보기

1. 필요한 경우 Azure 계정 자격 증명을 사용하여 [portal.azure.com](https://portal.azure.com)에 로그인합니다.

    Azure 계정이 두 개 이상인 경우 이 과정에 사용할 구독에 연결된 계정으로 로그인해야 합니다.

1. AZ-220 대시보드가 표시되는지 확인합니다.

1. **rg-az220** 리소스 그룹 타일에서 **iot-az220-training-{your-id}**를 클릭합니다.

    IoT Hub 블레이드를 처음 열면 **개요** 정보가 표시됩니다. 보시다시피 이 블레이드 상단의 영역은 데이터 센터 위치 및 구독과 같은 IoT Hub 서비스에 대한 몇 가지 필수 정보를 제공합니다. 그러나 이 블레이드에는 허브 사용 방법 및 최근 활동에 대한 정보를 제공하는 타일도 포함되어 있습니다. 이러한 타일이 더 어떻게 나타나는지 살펴보겠습니다.

1. IoT Hub 블레이드의 왼쪽 하단에 **IoT Hub 사용** 타일이 표시됩니다.

    > **참고**:  타일 위치는 브라우저 창의 너비에 따라 결정되므로 레이아웃이 설명된 것과 약간 다를 수 있습니다.

    이 타일은 허브 및 메시지 수에 연결된 내용에 대한 간략한 개요를 제공합니다. 디바이스를 추가하고 메시지 보내기를 시작하면 이 타일은 좋은 "한눈에 보기" 정보를 제공합니다.

1. **IoT Hub 사용** 타일의 오른쪽에서 **사용한 메시지 수** 타일과 **디바이스-클라우드 메시지** 타일을 확인합니다.

    **디바이스-클라우드 메시지** 타일을 사용하면 시간이 지남에 따라 디바이스에서 들어오는 메시지를 빠르게 볼 수 있습니다. 다음 모듈에서 디바이스를 등록하고 IoT Hub로 메시지를 전송합니다. 그러므로 잠시 후부터 이러한 타일에 정보가 표시되기 시작할 것입니다.

    **사용한 메시지 수** 타일에서는 사용한 메시지의 총 수를 추적할 수 있습니다.

#### 작업 2: 왼쪽 메뉴를 사용하여 IoT Hub의 기능 보기

1. IoT Hub 블레이드에서 왼쪽 메뉴 옵션을 잠시 살펴봅니다.

    예상대로 이러한 메뉴 옵션은 IoT Hub의 속성 및 기능에 대한 액세스를 제공하는 창을 여는 데 사용됩니다. 예를 들어 허브에 연결된 디바이스에 액세스하는 창을 열 수 있습니다.

1. 왼쪽 메뉴의 **탐색기** 아래에서 **IoT 디바이스**를 클릭합니다.

    이 창을 사용하여 허브에 등록된 디바이스를 추가, 수정 및 삭제할 수 있습니다. 이 과정이 끝나면 이 창에 익숙해질 것입니다.

1. 왼쪽 메뉴에서 상단 근처의 **활동 로그**를 클릭합니다.

    이름에서 알 수 있듯이 이 창을 사용하면 활동을 검토하고 문제를 진단하는 데 사용할 수 있는 로그에 액세스할 수 있습니다. 일상적인 작업에 도움이 되는 쿼리를 정의할 수도 있습니다. 매우 편리합니다.

1. 왼쪽 메뉴에서 **설정**에서 **기본 제공 엔드포인트**를 클릭합니다.

    IoT Hub는 외부 연결을 가능하게 하는 "엔드포인트"를 노출합니다. 기본적으로 엔드포인트는 IoT Hub에 연결하거나 IoT Hub와 통신하는 모든 것입니다. 허브에 이미 두 개의 엔드포인트가 정의된 것을 확인해야 합니다.

    * _이벤트_
    * _클라우드에서 디바이스 메시지로_

1. 왼쪽 메뉴 **메시지**에서 **메시지 라우팅**을 클릭합니다.

    IoT Hub 메시지 라우팅 기능을 사용하면 들어오는 디바이스-클라우드 메시지를 Azure Storage 컨테이너, Event Hubs 및 Service Bus 큐와 같은 서비스 엔드포인트로 라우팅할 수 있습니다. 라우팅 규칙을 만들어 쿼리 기반 경로를 수행할 수도 있습니다.

1. **메시지 라우팅** 상단에서 **사용자 지정 엔드포인트**를 클릭합니다.

    사용자 지정 엔드포인트(예: Service Bus 큐 및 Storage)는 IoT 구현 내에서 자주 사용됩니다.

1. 잠시 **설정**에서 메뉴 옵션을 살펴봅니다.

    > **참고**:  이 랩 연습은 IoT Hub 서비스에 대한 소개일 뿐이며 UI에 익숙해지기 위한 것이므로 이 시점에서 조금 부담스러워도 걱정할 필요가 없습니다. 이 과정을 진행하면서 IoT Hub, 디바이스 및 통신을 구성하고 관리하게 됩니다.

### 연습 4: Azure Portal을 사용하여 디바이스 프로비저닝 서비스 만들기

Azure IoT Hub Device Provisioning Service는 사람의 개입 없이 적절한 IoT 허브에 제로 터치, Just-In-Time 프로비저닝을 가능하게 하는 IoT Hub용 도우미 서비스입니다. 디바이스 프로비저닝 서비스는 다음을 제공합니다.

* 출하 시(초기 설정) IoT Hub 연결 정보를 하드코딩하지 않고 단일 IoT 솔루션으로 무인 프로비전
* 여러 허브에서 디바이스 부하 분산
* 판매 트랜잭션 데이터에 따라 해당 소유자의 IoT 솔루션에 디바이스 연결(다중 테넌트)
* 사용 사례에 따라 특정 IoT 솔루션에 디바이스 연결(솔루션 격리)
* 대기 시간이 가장 낮은 IoT Hub에 디바이스 연결(지리적 분할)
* 디바이스의 변경 내용에 따라 다시 프로비전
* 디바이스를 IoT Hub에 연결하는 데 사용되는 키 롤링(X.509 인증서를 사용하여 연결하는 경우)

IoT Hub Device Provisioning Service의 인스턴스를 만드는 방법에는 몇 가지가 있습니다. 예를 들어, Azure Portal을 쓸 수 있는데 이 작업 중에 사용해 볼 것입니다. 그러나, Azure CLI 또는 Azure Resource Manager 템플릿을 사용하여 DPS 인스턴스를 만들 수도 있습니다.

#### 작업 1: Azure Portal을 사용하여 리소스(디바이스 프로비저닝 서비스) 만들기

1. 필요한 경우 Azure 계정 자격 증명을 사용하여 [portal.azure.com](https://portal.azure.com)에 로그인합니다.

    Azure 계정이 두 개 이상인 경우 이 과정에 사용할 구독에 연결된 계정으로 로그인해야 합니다.

1. Azure Portal 메뉴에서 **+ 리소스 만들기**를 클릭합니다.

    앞에서 살펴본 것처럼 **새로 만들기** 블레이드에서는 Azure Marketplace에서 서비스를 검색하는 기능을 제공합니다.

1. 검색 텍스트 상자에서 **디바이스 프로비저닝 서비스**를 입력한 다음 Enter 키를 누릅니다.

1. **Marketplace** 블레이드에서 **IoT Hub Device Provisioning Service** 검색 결과를 클릭합니다.

    > **참고**:
    > **IoT Hub Device Provisioning Service** 검색 결과 아래쪽에 표시되는 **만들기** 작업을 클릭하면 IoT Hub Device Provisioning Service 만들기 보기로 바로 이동할 수 있습니다. 일반적인 사용 상황에서는 이 작업을 클릭할 수 있습니다. 하지만 이 자습서에서는 **IoT Hub Device Provisioning Service** 검색 결과 본문의 아무 위치나 클릭합니다.

1. **IoT Hub Device Provisioning Service** 블레이드에서 **사용량 정보 + 지원**을 클릭합니다.

    **유용한 링크** 아래에서 리소스 링크 목록을 살펴봅니다.

    다시 말하자면, 지금 이 문서를 탐색할 필요는 없지만 사용 가능하다는 것을 알고 있는 게 좋습니다. IoT Hub Device Provisioning Service 설명서 페이지는 DPS의 루트 페이지입니다. 이 페이지를 사용하면 현재 설명서를 살펴보거나 이 과정의 범위를 벗어난 활동에 대해 알아보는 데 도움이 되는 자습서 및 기타 리소스를 찾을 수 있습니다. 이 과정 전반에 걸쳐 특정 주제에 대한 추가적인 읽을거리를 제공하기 위해 docs.microsoft.com 사이트를 참조해 드립니다.

    링크 중 하나를 열었다면 지금 닫고 브라우저에서 Azure Portal 탭으로 다시 이동합니다.

#### 작업 2: 필요한 속성 설정으로 디바이스 프로비저닝 서비스 만들기

1. 새 DPS 인스턴스를 만드는 프로세스를 시작하려면 **만들기**를 클릭합니다.

    그 다음 Hub 및 구독에 대한 정보를 지정해야 합니다. 다음 단계에서는 설정을 안내하고 각 필드를 채울 때 마다 설명을 덧붙입니다.

1. **이름** 아래에 IoT Hub Device Provisioning Service의 전역에서 고유한 이름을 다음과 같이 입력합니다.

    전역적으로 고유한 이름을 제공하려면 **dps-az220-training-{your-id}**를 입력합니다(**{your-id}**는 연습 1에서 만든 고유 ID로 바꿔야 함).

    예를 들어 **dps-az220-training-cah191216**과 같이 입력할 수 있습니다.

1. **구독**에서 이 과정에 사용 중인 구독이 선택되어 있는지 확인합니다.

1. **리소스 그룹** 아래에서 드롭다운을 열고 **rg-az220**을 클릭합니다.

    이 과정에서 만든 리소스를 동일한 리소스 그룹들과 함께 그룹화합니다. 모범 사례에 따라 이 방식으로 관련 리소스를 그룹화하면 더 이상 필요하지 않은 리소스를 정리할 수 있습니다.

1. **위치** 아래에서 드롭다운 목록을 열고 리소스 그룹용으로 선택한 것과 같은 지역을 선택합니다.

    > **참고**: 리소스를 호스팅할 데이터 센터를 선택할 때 최종 사용자에게 가까운 데이터 센터를 선택하면 로드/응답 시간이 줄어듭니다. 최종 사용자로부터 세계의 반대편에 있는 경우 가장 가까운 데이터 센터를 선택해서는 안 됩니다.

1. 블레이드 하단의 **만들기**를 클릭합니다.

    배포를 완료하는 데 1분 이상 걸릴 수 있습니다. Azure Portal 알림 창을 열어 진행을 모니터링할 수 있습니다.

1. 몇 분 후에 IoT Hub Device Provisioning Service 인스턴스가 **rg-az220** 리소스 그룹에 성공적으로 배포되었다는 알림을 받게 됩니다.

1. Azure Portal 메뉴에서 **대시보드**, **새로 고침**을 차례로 클릭합니다.

    리소스 그룹 타일에 새 IoT Hub Device Provisioning Service가 나열되어 있는지 확인합니다.

#### 작업 3: IoT Hub 및 디바이스 프로비저닝 서비스를 연결합니다.

1. AZ-220 대시보드에는 IoT Hub 및 DPS 리소스가 모두 나열됩니다.

    IoT Hub 및 DPS 리소스가 모두 나열되어 있습니다. 리소스가 최근에 만들어진 경우 **새로 고침**을 눌러야 할 수 있습니다.

1. **rg-az220** 리소스 그룹 타일에서 **dps-az220-training-{your-id}**를 클릭합니다.

1. **디바이스 프로비저닝 서비스** 블레이드의 **설정**에서 **연결된 IoT Hub**를 클릭합니다.

1. 블레이드 상단에서 **+추가**를 선택합니다.

    **IoT hub에 대한 링크 추가** 블레이드를 사용하여 디바이스 프로비저닝 서비스 인스턴스를 IoT 허브에 연결하는 데 필요한 정보를 제공합니다.

1. **IoT Hub에 링크 추가** 블레이드에서 **구독** 드롭다운이 이 과정에 사용 중인 구독을 표시하고 있는지 확인합니다.

    구독은 사용 가능한 IoT Hub 목록을 제공하는 데 사용됩니다.

1. IoT Hub 드롭다운을 연 다음 **iot-az220-training-{your-id}**를 클릭합니다.

    이전 연습에서 만든 IoT ub입니다.

1. 액세스 정책 드롭다운에서 **iothubowner**를 클릭합니다.

    _iothubowner_ 자격 증명은 지정된 IoT Hub와의 링크를 설정하는 데 필요한 사용 권한을 제공합니다.

1. 구성을 완료하려면 **저장**을 클릭합니다.

    선택한 IoT Hub가 연결된 IoT Hub 창에 표시됩니다. **새로 고침**을 클릭하여 연결된 IoT Hub를 표시해야 할  수 있습니다.

1. Azure Portal 메뉴에서 **대시보드**를 클릭합니다.

### 연습 5: 디바이스 프로비저닝 서비스 검토

IoT Hub Device Provisioning Service는 IoT Hub를 위한 도우미 서비스로, 사람이 개입할 필요 없이 적기에 올바른 IoT Hub에 무인 프로비전이 가능하여 고객은 안전하고 확장성이 뛰어난 방식으로 수백만 대의 디바이스를 프로비전할 수 있습니다.

#### 작업 1: Device Provisioning Service 개요 정보 살펴보기

1. 필요한 경우 Azure 계정 자격 증명을 사용하여 [portal.azure.com](https://portal.azure.com)에 로그인합니다.

    Azure 계정이 두 개 이상인 경우 이 과정에 사용할 구독에 연결된 계정으로 로그인해야 합니다.

1. AZ-220 대시보드가 표시되는지 확인합니다.

1. **rg-az220** 리소스 그룹 타일에서 **dps-az220-training-{your-id}**를 클릭합니다.

    Device Provisioning Service 인스턴스를 처음 열면 개요 정보가 표시됩니다. 보시다시피 블레이드 상단의 영역은 상태, 데이터 센터 위치 및 구독과 같은 DPS 인스턴스에 대한 몇 가지 필수 정보를 제공합니다. 이 블레이드는 또한 다음에 대한 액세스를 제공하는 _빠른 링크_ 섹션을 제공합니다.

    * [Azure IoT Hub Device Provisioning Service 설명서](https://docs.microsoft.com/ko-kr/azure/iot-dps/)
    * [IoT Hub Device Provisioning Service에 대해 자세히 알아보기](https://docs.microsoft.com/ko-kr/azure/iot-dps/about-iot-dps)
    * [디바이스 프로비저닝 개념](https://docs.microsoft.com/ko-kr/azure/iot-dps/concepts-service)
    * [가격 책정 및 확장 세부 정보](https://azure.microsoft.com/ko-kr/pricing/details/iot-hub/)

    나중에 시간이 되면 이러한 링크를 살펴볼 수 있습니다.

#### 작업 2: 탐색 메뉴를 사용하여 디바이스 프로비저닝 서비스의 기능 보기

1. 왼쪽 메뉴 옵션을 잠시 살펴봅니다.

    예상대로 이러한 옵션은 DPS 인스턴스의 활동 로그, 속성 및 기능에 대한 액세스를 제공하는 창을 엽니다.

1. 왼쪽 메뉴에서 상단 근처의 **활동 로그**를 클릭합니다.

    이름에서 알 수 있듯이 이 창을 사용하면 활동을 검토하고 문제를 진단하는 데 사용할 수 있는 로그에 액세스할 수 있습니다. 일상적인 작업에 도움이 되는 쿼리를 정의할 수도 있습니다. 매우 편리합니다.

1. 왼쪽 메뉴의 **설정**에서 **빠른 시작**을 클릭합니다.

    이 창에는 IoT Hub Device Provisioning Service 사용을 시작하기 위한 단계, 문서 링크 및 DPS 구성을 위한 다른 블레이드에 대한 바로 가기가 나열됩니다.

1. 왼쪽 메뉴의 **설정**에서 **공유 액세스 정책**을 클릭합니다.

    이 창은 액세스 정책 관리를 제공하고 기존 정책 및 관련 권한을 나열합니다.

1. 왼쪽 메뉴의 **설정**에서 **연결된 IoT Hub**를 클릭합니다.

    여기에서 이전에 연결된 IoT Hub를 볼 수 있습니다. Device Provisioning 서비스는 Device Provisioning 서비스에 연결된 IoT 허브에만 프로비전할 수 있습니다. IoT 허브를 Device Provisioning 서비스 인스턴스에 연결하면 서비스에 IoT 허브의 디바이스 레지스트리에 대한 읽기/쓰기 권한을 부여합니다. 링크를 사용하면 Device Provisioning 서비스는 디바이스 ID를 등록하고 디바이스 쌍에서 초기 구성을 설정할 수 있습니다. 연결된 IoT 허브는 모든 Azure 지역에 있을 수 있습니다. 다른 구독의 허브를 프로비전 서비스에 연결할 수 있습니다.

1. 왼쪽 메뉴의 **설정**에서 **인증서**를 클릭합니다.

    여기서 X.509 인증서 인증을 사용하여 Azure IoT Hub를 보호하는 데 사용할 수 있는 X.509 인증서를 관리할 수 있습니다. 이후 랩에서 X.509 인증서를 조사합니다.

1. 왼쪽 메뉴의 **설정**에서 **등록 관리**를 클릭합니다.

    여기에서 등록 그룹 및 개별 등록을 관리할 수 있습니다.

    등록 그룹은 원하는 초기 구성을 공유하는 많은 수의 디바이스 또는 모두 동일한 테넌트로 이동하는 디바이스에 사용할 수 있습니다. 등록 그룹은 특정 증명 메커니즘을 공유하는 디바이스의 그룹입니다. 등록 그룹은 X.509뿐 아니라 대칭도 모두 지원합니다. X.509 등록 그룹의 모든 디바이스는 동일한 루트 또는 중간 CA(인증 기관)에서 서명한 X.509 인증서를 제공합니다. 대칭 키 등록 그룹의 각 디바이스는 그룹 대칭 키에서 파생된 SAS 토큰을 제공합니다. 등록 그룹 이름 및 인증서 이름은 영숫자, 소문자여야 하며 하이픈을 포함할 수 있습니다.

    개별 등록은 등록할 수 있는 단일 디바이스에 대한 항목입니다. 개별 등록은 증명 메커니즘으로 X.509 리프 인증서 또는 SAS 토큰(실제 또는 가상 TPM) 중 하나를 사용할 수 있습니다. 개별 등록의 등록 ID는 영숫자, 소문자이며 하이픈을 포함할 수 있습니다. 개별 등록에는 원하는 IoT Hub 디바이스 ID가 지정될 수 있습니다.

1. 잠시 **설정**에서 다른 메뉴 옵션 중 일부를 리뷰합니다.

   > **참고**:  이 랩은 IoT Hub Device Provisioning Service에 대한 소개일 뿐이며 UI에 익숙해지기 위한 것이므로 이 시점에서 조금 부담이 느껴지더라도 걱정하지 마십시오. 과정을 계속하면서 DPS를 훨씬 더 자세히 다룰 것입니다.
